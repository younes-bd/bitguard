{% extends 'crm/base_crm.html' %}
{% load static %}

{% block dashboard_content %}
<div class="dashboard-header-wrapper" style="margin-bottom: 30px;">
    <h1 style="font-size: 24px; font-weight: bold; color: var(--text-dashboard);">Staff Dashboard</h1>
    <p style="color: #6b7280; margin-top: 5px;">Overview of client management and support activities.</p>
</div>

<!-- Key Stats -->
<div class="grid-cols-3 mb-4" style="margin-bottom: 30px;">
    <!-- Total Clients -->
    <div class="card" style="margin-bottom: 0; display: flex; align-items: center; gap: 20px;">
        <div
            style="width: 50px; height: 50px; background-color: #e0e7ff; color: #4338ca; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px;">
            <i class="fas fa-users"></i>
        </div>
        <div>
            <div style="font-size: 13px; color: #6b7280; font-weight: 600; text-transform: uppercase;">Total Clients
            </div>
            <div style="font-size: 28px; font-weight: bold; color: var(--text-dashboard);">{{ total_clients }}</div>
            <div style="font-size: 12px; color: #10b981;"><span style="font-weight: 600;">{{ active_clients }}</span>
                active</div>
        </div>
    </div>

    <!-- Open Tickets -->
    <div class="card" style="margin-bottom: 0; display: flex; align-items: center; gap: 20px;">
        <div
            style="width: 50px; height: 50px; background-color: #fef3c7; color: #d97706; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px;">
            <i class="fas fa-ticket-alt"></i>
        </div>
        <div>
            <div style="font-size: 13px; color: #6b7280; font-weight: 600; text-transform: uppercase;">Open Tickets
            </div>
            <div style="font-size: 28px; font-weight: bold; color: var(--text-dashboard);">{{ open_tickets }}</div>
            {% if critical_tickets > 0 %}
            <div style="font-size: 12px; color: #ef4444; font-weight: 600;">{{ critical_tickets }} Critical</div>
            {% else %}
            <div style="font-size: 12px; color: #10b981;">No critical issues</div>
            {% endif %}
        </div>
    </div>

    <!-- Quick Actions (Placeholder for now) -->
    <div class="card"
        style="margin-bottom: 0; display: flex; flex-direction: column; justify-content: center; gap: 10px;">
        <a href="{% url 'admin:crm_client_add' %}" target="_blank"
            style="background-color: #312e81; color: white; text-decoration: none; padding: 10px; border-radius: 8px; text-align: center; font-weight: 600; font-size: 14px; transition: opacity 0.2s;">
            <i class="fas fa-plus" style="margin-right: 8px;"></i> New Client
        </a>
        <a href="{% url 'crm_tickets' %}"
            style="background-color: white; border: 1px solid #e5e7eb; color: #374151; text-decoration: none; padding: 10px; border-radius: 8px; text-align: center; font-weight: 600; font-size: 14px;">
            View Support Queue
        </a>
    </div>
</div>

<div class="grid-cols-2">
    <!-- Recent Tickets -->
    <div class="card">
        <div class="flex-between mb-4">
            <h3 class="text-xl">Recent Tickets</h3>
            <a href="{% url 'crm_tickets' %}"
                style="color: #4338ca; text-decoration: none; font-size: 13px; font-weight: 600;">View All</a>
        </div>

        <table class="platform-table">
            <thead>
                <tr>
                    <th>Subject</th>
                    <th>Status</th>
                    <th>Priority</th>
                </tr>
            </thead>
            <tbody>
                {% for ticket in recent_tickets %}
                <tr>
                    <td>
                        <div
                            style="font-weight: 600; max-width: 200px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                            {{ ticket.summary }}</div>
                        <div style="font-size: 11px; color: #6b7280;">{{ ticket.client.name }}</div>
                    </td>
                    <td>
                        <span
                            class="badge {% if ticket.status == 'open' %}badge-high{% else %}badge-medium{% endif %}">{{
                            ticket.get_status_display }}</span>
                    </td>
                    <td>
                        <span
                            style="font-size: 11px; font-weight: 700; color: {% if ticket.priority == 'critical' %}#ef4444{% elif ticket.priority == 'high' %}#f97316{% else %}#6b7280{% endif %};">
                            {{ ticket.get_priority_display|upper }}
                        </span>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="3" style="text-align: center; color: #9ca3af; padding: 20px;">No recent tickets.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Recent Orders -->
    <div class="card">
        <div class="flex-between mb-4">
            <h3 class="text-xl">Recent Orders</h3>
        </div>

        <table class="platform-table">
            <thead>
                <tr>
                    <th>Order</th>
                    <th>User</th>
                    <th>Amount</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for order in recent_orders %}
                <tr>
                    <td>#{{ order.id }}</td>
                    <td>
                        <div>{{ order.user.username }}</div>
                        <div style="font-size: 10px; color: #9ca3af;">{{ order.created_at|date:"M d" }}</div>
                    </td>
                    <td>${{ order.amount }}</td>
                    <td><span class="badge" style="background-color: #f3f4f6;">{{ order.status|title }}</span></td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" style="text-align: center; color: #9ca3af; padding: 20px;">No recent orders.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}