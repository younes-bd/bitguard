{% extends 'erp/base.html' %}
{% load static %}

{% block page_title %}{% if object %}Edit Task{% else %}New Task{% endif %}{% endblock %}

{% block erp_content %}
<div>
    <div style="display: flex; justify-content: center;">
        <div class="card" style="width: 100%; max-width: 800px; padding: 32px;">
            <div class="flex-between mb-6" style="padding-bottom: 16px; border-bottom: 1px solid var(--border-color);">
                <div>
                    <h2 class="text-xl font-bold text-dark">{% if object %}Edit Task{% else %}Create Task{% endif %}
                    </h2>
                    <p class="text-sm text-gray mt-1">Assign work to team members.</p>
                </div>
                <a href="{% url 'erp_task_list' %}" class="btn-text"
                    style="text-decoration: none; color: var(--text-secondary); font-size: 14px; display: flex; align-items: center; gap: 6px;">
                    <i class="fas fa-times"></i> Cancel
                </a>
            </div>

            <form method="post">
                {% csrf_token %}

                <!-- Project & Assignee -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 24px;">
                    <div class="form-group">
                        <label class="form-label">Project</label>
                        <div class="custom-select-wrapper">
                            {{ form.project }}
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Assign To</label>
                        <div class="custom-select-wrapper">
                            {{ form.assigned_to }}
                        </div>
                    </div>
                </div>

                <!-- Title -->
                <div class="form-group" style="margin-bottom: 24px;">
                    <label class="form-label">Task Title</label>
                    <input type="text" name="title" value="{{ form.title.value|default:'' }}" class="form-control"
                        placeholder="What needs to be done?">
                </div>

                <!-- Description -->
                <div class="form-group" style="margin-bottom: 24px;">
                    <label class="form-label">Description</label>
                    <textarea name="description" rows="5" class="form-control"
                        placeholder="Detailed instructions...">{{ form.description.value|default:'' }}</textarea>
                </div>

                <!-- Metadata -->
                <div
                    style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; padding-top: 24px; border-top: 1px solid var(--border-color);">
                    <div class="form-group">
                        <label class="form-label">Priority</label>
                        <div class="custom-select-wrapper">
                            {{ form.priority }}
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <div class="custom-select-wrapper">
                            {{ form.status }}
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Estimated Hours</label>
                        <input type="number" name="estimated_hours" value="{{ form.estimated_hours.value|default:'0' }}"
                            class="form-control">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Due Date</label>
                        <input type="date" name="due_date" value="{{ form.due_date.value|date:'Y-m-d' }}"
                            class="form-control">
                    </div>
                </div>

                <!-- Footer -->
                <div class="flex-center gap-3"
                    style="justify-content: flex-end; padding-top: 24px; border-top: 1px solid var(--border-color); margin-top: 32px;">
                    <a href="{% url 'erp_task_list' %}" class="btn-secondary">Discard</a>
                    <button type="submit" class="btn-primary" style="padding-left: 32px; padding-right: 32px;">Save
                        Task</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const inputs = document.querySelectorAll('input, select, textarea');
        inputs.forEach(input => {
            if (!input.classList.contains('form-control')) {
                input.classList.add('form-control');
            }
            if (input.tagName === 'SELECT' || input.tagName === 'INPUT' || input.tagName === 'TEXTAREA') {
                input.style.width = '100%';
            }
        });
        const selects = document.querySelectorAll('select');
        selects.forEach(sel => {
            sel.style.height = '42px';
            sel.style.border = '1px solid var(--border-color)';
            sel.style.borderRadius = '6px';
            sel.style.padding = '0 12px';
        });
    });
</script>
{% endblock %}