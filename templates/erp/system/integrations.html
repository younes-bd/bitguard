{% extends 'erp/base.html' %}
{% load static %}

{% block page_title %}Integrations{% endblock %}

{% block erp_content %}
<div>
    <div class="flex-between mb-8">
        <div>
            <h2 class="text-2xl font-bold text-dark">Integrations</h2>
            <p class="text-sm text-gray mt-1">Connect your favorite tools to BitGuard ERP.</p>
        </div>
        <button class="btn-secondary">
            <i class="fas fa-book mr-2"></i> Documentation
        </button>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for integration in integrations %}
        <div class="card p-6 flex flex-col h-full bg-white dark:bg-gray-800 transition-all hover:shadow-md"
            style="border: 1px solid var(--border-color);">

            <div class="flex justify-between items-start mb-4">
                <div
                    class="w-12 h-12 rounded-lg bg-gray-50 dark:bg-gray-700 flex items-center justify-center text-2xl text-dark shadow-sm">
                    <i class="{{ integration.icon_class }}"></i>
                </div>

                <!-- Toggle Switch -->
                <form action="{% url 'erp_integration_toggle' integration.pk %}" method="post" class="cursor-pointer"
                    onclick="this.submit()">
                    {% csrf_token %}
                    <div
                        class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in pointer-events-none">
                        <input type="checkbox" name="toggle" id="toggle_{{ integration.id }}"
                            class="toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-4 appearance-none cursor-pointer border-gray-300 transition-transform duration-200 ease-in-out {% if integration.is_active %}translate-x-full border-green-400{% endif %}"
                            {% if integration.is_active %}checked{% endif %} />
                        <label for="toggle_{{ integration.id }}"
                            class="toggle-label block overflow-hidden h-5 rounded-full bg-gray-300 cursor-pointer {% if integration.is_active %}bg-green-400{% endif %}"></label>
                    </div>
                </form>
            </div>

            <h3 class="text-lg font-bold text-dark mb-1">{{ integration.get_name_display }}</h3>
            <p class="text-sm text-gray mb-6 flex-grow">
                {% if integration.name == 'stripe' %}
                Sync invoices, subscriptions, and payments automatically.
                {% elif integration.name == 'slack' %}
                Receive real-time alerts for system events and task updates.
                {% elif integration.name == 'github' %}
                Link commits to projects and track deployment status.
                {% elif integration.name == 'aws' %}
                Monitor cloud infrastructure and asset usage costs.
                {% else %}
                Connect {{ integration.get_name_display }} to your workflow.
                {% endif %}
            </p>

            {% if integration.is_active %}
            <div
                class="bg-green-50 dark:bg-green-900/10 border border-green-100 dark:border-green-900/30 rounded-md p-3 mb-4">
                <div class="flex items-center gap-2 text-xs text-green-700 dark:text-green-400 font-bold mb-1">
                    <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                    Connected
                </div>
                <div class="text-xs text-green-600 dark:text-green-500 truncate">
                    Last sync: {{ integration.last_sync|date:"M d, H:i"|default:"Just now" }}
                </div>
            </div>
            {% else %}
            <div class="bg-gray-50 dark:bg-gray-700/30 border border-gray-100 dark:border-gray-700 rounded-md p-3 mb-4">
                <div class="flex items-center gap-2 text-xs text-gray-500 font-bold">
                    <div class="w-2 h-2 bg-gray-400 rounded-full"></div>
                    Not Connected
                </div>
            </div>
            {% endif %}

            <a href="{% url 'erp_integration_edit' integration.pk %}"
                class="btn-secondary w-full text-xs justify-center gap-2">
                <i class="fas fa-cog"></i> Configure
            </a>
        </div>
        {% endfor %}
    </div>
</div>

<style>
    /* Custom Toggle Styles because Tailwind forms plugin might act up */
    .toggle-checkbox:checked {
        right: 0;
        border-color: #68D391;
    }

    .toggle-checkbox:checked+.toggle-label {
        background-color: #68D391;
    }
</style>
{% endblock %}