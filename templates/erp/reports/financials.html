{% extends 'erp/base.html' %}
{% load static %}

{% block page_title %}Financial Report{% endblock %}

{% block erp_content %}
<div>
    <div class="flex-between mb-6 print:hidden" style="margin-bottom: 24px;">
        <div>
            <h2 class="text-2xl font-bold text-dark">Exec Financial Report</h2>
            <p class="text-sm text-gray mt-1">Generated on {% now "F j, Y" %}</p>
        </div>
        <div class="flex-center gap-2">
            <button onclick="window.print()" class="btn-secondary">
                <i class="fas fa-print" style="margin-right: 8px;"></i> Print Report
            </button>
            <button class="btn-primary">
                <i class="fas fa-file-export" style="margin-right: 8px;"></i> Export PDF
            </button>
        </div>
    </div>

    <div class="card p-8 print:p-0 print:shadow-none bg-white dark:bg-gray-800">
        <!-- Header for Print -->
        <div class="flex-between mb-8 pb-4"
            style="border-bottom: 1px solid var(--border-color); margin-bottom: 32px; padding-bottom: 16px;">
            <div>
                <div class="text-2xl font-bold tracking-widest text-dark uppercase mb-1">BITGUARD</div>
                <div class="text-xs text-gray">Enterprise Resource Planning</div>
            </div>
            <div style="text-align: right;">
                <div class="text-sm font-bold text-gray uppercase tracking-wider">CONFIDENTIAL</div>
                <div class="text-xs text-gray">Internal Use Only</div>
            </div>
        </div>

        <!-- High Level Summary -->
        <div style="margin-bottom: 40px;">
            <h3 class="text-lg font-bold text-dark mb-6" style="margin-bottom: 24px;">Executive Summary</h3>
            <div class="stats-grid">
                <div class="stat-card" style="background: var(--bg-body);">
                    <div class="text-xs font-bold text-gray uppercase tracking-wider mb-2">Total Revenue (YTD)</div>
                    <div class="text-3xl font-bold text-dark">${{ total_revenue|floatformat:0 }}</div>
                </div>
                <div class="stat-card" style="background: var(--bg-body);">
                    <div class="text-xs font-bold text-gray uppercase tracking-wider mb-2">Operating Profit</div>
                    <div class="text-3xl font-bold {% if net_profit > 0 %}text-green{% else %}text-red{% endif %}">
                        ${{ net_profit|floatformat:0 }}
                    </div>
                </div>
                <div class="stat-card" style="background: var(--bg-body);">
                    <div class="text-xs font-bold text-gray uppercase tracking-wider mb-2">Profit Margin</div>
                    <div class="text-3xl font-bold {% if profit_margin > 0 %}text-dark{% else %}text-red{% endif %}">
                        {{ profit_margin|floatformat:1 }}%
                    </div>
                </div>
            </div>
        </div>

        <!-- P&L Table -->
        <div style="margin-bottom: 32px;">
            <h3 class="text-lg font-bold text-dark mb-4" style="margin-bottom: 16px;">Profit & Loss Statement</h3>
            <div style="border: 1px solid var(--border-color); border-radius: 8px; overflow: hidden;">
                <table class="platform-table" style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr
                            style="background: var(--bg-body); border-bottom: 1px solid var(--border-color); text-align: left;">
                            <th style="padding: 12px 16px;">Category</th>
                            <th style="padding: 12px 16px; text-align: right;">Amount</th>
                            <th style="padding: 12px 16px; text-align: right;">% of Rev</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Revenue Section -->
                        <tr style="background: var(--bg-body); font-weight: bold;">
                            <td
                                style="padding: 12px 16px; color: var(--text-secondary); font-size: 12px; letter-spacing: 0.05em;">
                                REVENUE</td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td style="padding: 12px 16px; padding-left: 32px;">Project Services</td>
                            <td style="padding: 12px 16px; text-align: right; font-family: monospace;">${{
                                project_revenue|floatformat:0 }}</td>
                            <td
                                style="padding: 12px 16px; text-align: right; color: var(--text-secondary); font-family: monospace;">
                                -</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px 16px; padding-left: 32px;">Product Sales</td>
                            <td style="padding: 12px 16px; text-align: right; font-family: monospace;">${{
                                order_revenue|floatformat:0 }}</td>
                            <td
                                style="padding: 12px 16px; text-align: right; color: var(--text-secondary); font-family: monospace;">
                                -</td>
                        </tr>
                        <tr
                            style="font-weight: bold; background: var(--bg-body); border-top: 1px solid var(--border-color);">
                            <td style="padding: 12px 16px; color: var(--text-primary);">Total Revenue</td>
                            <td
                                style="padding: 12px 16px; text-align: right; color: var(--text-primary); font-family: monospace;">
                                ${{ total_revenue|floatformat:0 }}</td>
                            <td
                                style="padding: 12px 16px; text-align: right; color: var(--text-primary); font-family: monospace;">
                                100.0%</td>
                        </tr>

                        <!-- Expenses Section -->
                        <tr style="background: var(--bg-body); font-weight: bold;">
                            <td
                                style="padding: 12px 16px; padding-top: 16px; color: var(--text-secondary); font-size: 12px; letter-spacing: 0.05em;">
                                EXPENSES (COGS + OpEx)</td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td style="padding: 12px 16px; padding-left: 32px;">Internal Labor Cost</td>
                            <td
                                style="padding: 12px 16px; text-align: right; color: var(--status-critical); font-family: monospace;">
                                (${{ total_labor_cost|floatformat:0 }})</td>
                            <td
                                style="padding: 12px 16px; text-align: right; color: var(--text-secondary); font-family: monospace;">
                                ~</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px 16px; padding-left: 32px;">Vendor Bills & OpEx</td>
                            <td
                                style="padding: 12px 16px; text-align: right; color: var(--status-critical); font-family: monospace;">
                                (${{ total_bills|add:total_expenses|floatformat:0 }})</td>
                            <td
                                style="padding: 12px 16px; text-align: right; color: var(--text-secondary); font-family: monospace;">
                                ~</td>
                        </tr>
                        <tr
                            style="font-weight: bold; background: var(--bg-body); border-top: 1px solid var(--border-color);">
                            <td style="padding: 12px 16px; color: var(--text-primary);">Total Costs</td>
                            <td
                                style="padding: 12px 16px; text-align: right; color: var(--status-critical); font-family: monospace;">
                                (${{ total_costs|floatformat:0 }})</td>
                            <td style="padding: 12px 16px; text-align: right;"></td>
                        </tr>
                    </tbody>
                    <tfoot>
                        <tr style="background: var(--accent-primary); color: #fff; font-weight: bold; font-size: 16px;">
                            <td style="padding: 16px; background: rgba(59, 130, 246, 0.1);">NET PROFIT</td>
                            <td
                                style="padding: 16px; text-align: right; font-family: monospace; background: rgba(59, 130, 246, 0.1); color: {% if net_profit > 0 %}#4ade80{% else %}#f87171{% endif %};">
                                ${{ net_profit|floatformat:0 }}
                            </td>
                            <td
                                style="padding: 16px; text-align: right; font-family: monospace; background: rgba(59, 130, 246, 0.1); color: #e2e8f0; font-size: 14px;">
                                {{ profit_margin|floatformat:1 }}%
                            </td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>

        <div
            style="text-align: center; padding-top: 32px; border-top: 1px solid var(--border-color); color: var(--text-secondary); font-size: 12px;">
            Generated by BitGuard ERP System | Confidential | All data is real-time.
        </div>
    </div>
</div>
{% endblock %}