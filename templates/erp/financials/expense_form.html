{% extends 'erp/base.html' %}
{% load static %}

{% block page_title %}{% if object %}Edit Expense{% else %}New Expense{% endif %}{% endblock %}

{% block erp_content %}
<div>
    <div style="display: flex; justify-content: center;">
        <div class="card" style="width: 100%; max-width: 700px; padding: 32px;">
            <div class="flex-between mb-6" style="padding-bottom: 16px; border-bottom: 1px solid var(--border-color);">
                <div>
                    <h2 class="text-xl font-bold text-dark">{% if object %}Edit Expense{% else %}Submit Expense{% endif
                        %}</h2>
                    <p class="text-sm text-gray mt-1">Request reimbursement or record spending.</p>
                </div>
                <a href="{% url 'erp_expense_list' %}" class="btn-text"
                    style="color: var(--text-secondary); text-decoration: none; display: flex; align-items: center; gap: 6px;">
                    <i class="fas fa-times"></i> Cancel
                </a>
            </div>

            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}

                <!-- Main Info -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 24px;">
                    <div class="form-group" style="grid-column: span 2;">
                        <label class="form-label">Description</label>
                        {{ form.description }}
                    </div>

                    <div class="form-group">
                        <label class="form-label">Amount ($)</label>
                        {{ form.amount }}
                    </div>

                    <div class="form-group">
                        <label class="form-label">Date</label>
                        <input type="date" name="date" value="{{ form.date.value|date:'Y-m-d' }}" class="form-control">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Category</label>
                        <div class="custom-select-wrapper">{{ form.category }}</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Project (Optional)</label>
                        <div class="custom-select-wrapper">{{ form.project }}</div>
                    </div>
                </div>

                <!-- Receipt Upload -->
                <div style="padding-top: 24px; border-top: 1px solid var(--border-color); margin-bottom: 24px;">
                    <label class="form-label mb-2">Receipt / Invoice</label>
                    <div style="border: 2px dashed var(--border-color); border-radius: 8px; padding: 24px; text-align: center; cursor: pointer; transition: background 0.2s;"
                        onmouseover="this.style.background='var(--bg-body)'"
                        onmouseout="this.style.background='transparent'">
                        <i class="fas fa-cloud-upload-alt text-3xl mb-2" style="color: #cbd5e1;"></i>
                        <p class="text-sm text-dark font-medium">Click to upload or drag and drop</p>
                        <p class="text-xs text-gray mt-1">PDF, JPG, PNG up to 5MB</p>
                        <div style="display: none;">{{ form.receipt }}</div>
                    </div>
                </div>

                <!-- Status (Admin only ideally, but form might have it) -->
                {% if perms.erp.change_expense %}
                <div style="padding-top: 24px; border-top: 1px solid var(--border-color);">
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <div class="custom-select-wrapper">{{ form.status }}</div>
                    </div>
                </div>
                {% endif %}

                <!-- Footer -->
                <div class="flex-center gap-3"
                    style="justify-content: flex-end; padding-top: 24px; border-top: 1px solid var(--border-color); margin-top: 32px;">
                    <a href="{% url 'erp_expense_list' %}" class="btn-secondary">Discard</a>
                    <button type="submit" class="btn-primary" style="padding-left: 32px; padding-right: 32px;">Submit
                        Expense</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const inputs = document.querySelectorAll('input, select, textarea');
        inputs.forEach(input => {
            if (!input.classList.contains('form-control') && input.type !== 'file') {
                input.classList.add('form-control');
            }
            if (input.tagName === 'SELECT' || input.tagName === 'INPUT' || input.tagName === 'TEXTAREA') {
                input.style.width = '100%';
            }
        });
        const selects = document.querySelectorAll('select');
        selects.forEach(sel => {
            sel.style.height = '42px';
            sel.style.border = '1px solid var(--border-color)';
            sel.style.borderRadius = '6px';
            sel.style.padding = '0 12px';
        });
    });
</script>
{% endblock %}