{% extends 'erp/base.html' %}
{% load static %}

{% block page_title %}Invoice {{ invoice.invoice_number }}{% endblock %}

{% block erp_content %}
<div>
    <!-- Header -->
    <div class="flex-between mb-6">
        <div>
            <div class="flex-center gap-3">
                <a href="{% url 'erp_invoice_list' %}" class="text-gray hover:text-dark"><i
                        class="fas fa-arrow-left"></i></a>
                <h1 class="text-2xl font-bold text-dark">Invoice {{ invoice.invoice_number }}</h1>
                {% if invoice.status == 'paid' %}
                <span class="badge badge-active">Paid</span>
                {% elif invoice.status == 'sent' %}
                <span class="badge badge-medium">Sent</span>
                {% else %}
                <span class="badge badge-default">Draft</span>
                {% endif %}
            </div>
            <p class="text-gray text-sm mt-1 ml-6">For {{ invoice.client.name }}</p>
        </div>
        <div class="flex-center gap-3">
            <a href="{% url 'erp_invoice_edit' invoice.pk %}" class="btn-secondary">
                <i class="fas fa-edit mr-2"></i> Edit
            </a>
            <button class="btn-primary" onclick="window.print()">
                <i class="fas fa-print mr-2"></i> Print
            </button>
        </div>
    </div>

    <!-- Info Cards -->
    <div class="grid grid-cols-3 gap-6 mb-8">
        <div class="card">
            <h3 class="text-xs font-bold text-gray uppercase tracking-wider mb-2">Details</h3>
            <div class="text-sm">
                <div class="mb-1"><strong>Date:</strong> {{ invoice.issue_date }}</div>
                <div class="mb-1"><strong>Due:</strong> {{ invoice.due_date }}</div>
                {% if invoice.contract %}
                <div class="mb-1 text-blue-600"><strong>Contract:</strong> {{ invoice.contract.name }}</div>
                {% endif %}
            </div>
        </div>
        <div class="card">
            <h3 class="text-xs font-bold text-gray uppercase tracking-wider mb-2">Totals</h3>
            <div class="text-sm">
                <div class="flex-between mb-1"><span>Subtotal:</span> <span>${{ invoice.subtotal }}</span></div>
                <div class="flex-between mb-1"><span>Tax:</span> <span>${{ invoice.tax }}</span></div>
                <div class="flex-between font-bold text-lg mt-2 pt-2 border-t border-gray-100">
                    <span>Total:</span> <span>${{ invoice.total }}</span>
                </div>
            </div>
        </div>
        <div class="card">
            <h3 class="text-xs font-bold text-gray uppercase tracking-wider mb-2">Notes</h3>
            <p class="text-sm text-gray italic">{{ invoice.notes|default:"No notes." }}</p>
        </div>
    </div>

    <!-- Line Items -->
    <div class="card">
        <div class="flex-between mb-4">
            <h3 class="text-lg font-bold text-dark">Line Items</h3>
            <a href="{% url 'erp_invoice_item_create' invoice.pk %}"
                class="text-sm text-blue-600 hover:underline font-semibold">
                <i class="fas fa-plus mr-1"></i> Add Product/Service
            </a>
        </div>
        <table class="platform-table">
            <thead>
                <tr>
                    <th>Description</th>
                    <th>Product</th>
                    <th class="text-right">Qty</th>
                    <th class="text-right">Unit Price</th>
                    <th class="text-right">Amount</th>
                </tr>
            </thead>
            <tbody>
                {% for item in invoice.items.all %}
                <tr>
                    <td>{{ item.description }}</td>
                    <td>
                        {% if item.product %}
                        <span class="badge" style="background-color: #e0e7ff; color: #4338ca;">
                            <i class="fas fa-box mr-1"></i> {{ item.product.name }}
                        </span>
                        {% else %}
                        <span class="text-gray text-xs">-</span>
                        {% endif %}
                    </td>
                    <td class="text-right">{{ item.quantity }}</td>
                    <td class="text-right">${{ item.unit_price }}</td>
                    <td class="text-right font-bold">${{ item.amount }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" class="text-center p-8 text-gray">No items added yet.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}