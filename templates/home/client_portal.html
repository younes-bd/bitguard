{% extends "base.html" %}
{% load static %}

{% block content %}
<section class="tw-bg-slate-50 tw-min-h-screen tw-pt-32">
    <div class="tw-container tw-mx-auto tw-px-4 tw-mb-12">
        <div class="tw-flex tw-justify-between tw-items-center tw-mb-8">
            <div>
                <h1 class="tw-text-3xl tw-font-bold tw-text-slate-900">Client Portal</h1>
                <p class="tw-text-slate-600">Welcome back, {{ request.user.username }}</p>
            </div>
            <a href="{% url 'support' %}" class="btn-bitguard">
                <i class="fas fa-plus tw-mr-2"></i> New Ticket
            </a>
        </div>

        <div class="tw-grid tw-grid-cols-1 lg:tw-grid-cols-3 tw-gap-8">

            <!-- Column 1: Tickets -->
            <div class="tw-space-y-6">
                <h2 class="tw-text-xl tw-font-bold tw-text-slate-800 tw-flex tw-items-center">
                    <i class="fas fa-ticket-alt tw-text-emerald-500 tw-mr-3"></i> Support Tickets
                </h2>

                {% if tickets %}
                {% for ticket in tickets %}
                <div class="bitguard-card tw-bg-white tw-p-6 tw-rounded-xl tw-shadow-sm tw-border tw-border-slate-100">
                    <div class="tw-flex tw-justify-between tw-items-start tw-mb-2">
                        <span
                            class="tw-text-xs tw-font-bold tw-uppercase {% if ticket.status == 'closed' %}tw-text-green-600 tw-bg-green-50{% else %}tw-text-blue-600 tw-bg-blue-50{% endif %} tw-px-2 tw-py-1 tw-rounded-md">
                            {{ ticket.get_status_display }}
                        </span>
                        <span class="tw-text-xs tw-text-slate-400">{{ ticket.created_at|date:"M d, Y" }}</span>
                    </div>
                    <h3 class="tw-font-bold tw-text-slate-900 tw-mb-1">{{ ticket.subject }}</h3>
                    <p class="tw-text-sm tw-text-slate-500 tw-line-clamp-2">{{ ticket.description|truncatewords:20 }}
                    </p>
                </div>
                {% endfor %}
                {% else %}
                <div
                    class="tw-text-center tw-py-12 tw-bg-white tw-rounded-xl tw-border tw-border-dashed tw-border-slate-300">
                    <p class="tw-text-slate-500">No active tickets.</p>
                </div>
                {% endif %}
            </div>

            <!-- Column 2: Invoices -->
            <div class="tw-space-y-6">
                <h2 class="tw-text-xl tw-font-bold tw-text-slate-800 tw-flex tw-items-center">
                    <i class="fas fa-file-invoice-dollar tw-text-indigo-500 tw-mr-3"></i> Recent Invoices
                </h2>

                {% if invoices %}
                <div
                    class="bitguard-card tw-bg-white tw-overflow-hidden tw-rounded-xl tw-shadow-sm tw-border tw-border-slate-100">
                    <table class="tw-w-full tw-text-sm tw-text-left">
                        <thead class="tw-bg-slate-50 tw-text-slate-500 tw-font-medium">
                            <tr>
                                <th class="tw-px-6 tw-py-4">Invoice #</th>
                                <th class="tw-px-6 tw-py-4">Date</th>
                                <th class="tw-px-6 tw-py-4">Amount</th>
                                <th class="tw-px-6 tw-py-4">Status</th>
                            </tr>
                        </thead>
                        <tbody class="tw-divide-y tw-divide-slate-100">
                            {% for inv in invoices %}
                            <tr class="hover:tw-bg-slate-50/50">
                                <td class="tw-px-6 tw-py-4 tw-font-medium tw-text-slate-900">#{{ inv.id }}</td>
                                <td class="tw-px-6 tw-py-4 tw-text-slate-500">{{ inv.issued_date|date:"M d, Y" }}</td>
                                <td class="tw-px-6 tw-py-4 tw-text-slate-900">${{ inv.amount }}</td>
                                <td class="tw-px-6 tw-py-4">
                                    <span
                                        class="tw-px-2 tw-py-1 tw-rounded-full tw-text-xs tw-font-bold 
                                        {% if inv.status|lower == 'paid' %}tw-bg-green-100 tw-text-green-700{% else %}tw-bg-amber-100 tw-text-amber-700{% endif %}">
                                        {{ inv.status|title }}
                                    </span>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div
                    class="tw-text-center tw-py-12 tw-bg-white tw-rounded-xl tw-border tw-border-dashed tw-border-slate-300">
                    <p class="tw-text-slate-500">No invoices found.</p>
                </div>
                {% endif %}
            </div>

            <!-- Column 3: Projects -->
            <div class="tw-space-y-6">
                <h2 class="tw-text-xl tw-font-bold tw-text-slate-800 tw-flex tw-items-center">
                    <i class="fas fa-project-diagram tw-text-sky-500 tw-mr-3"></i> Active Projects
                </h2>

                {% if projects %}
                {% for proj in projects %}
                <div class="bitguard-card tw-bg-white tw-p-6 tw-rounded-xl tw-shadow-sm tw-border tw-border-slate-100">
                    <div class="tw-flex tw-justify-between tw-mb-2">
                        <h3 class="tw-font-bold tw-text-slate-900">{{ proj.name }}</h3>
                        <span class="tw-text-xs tw-font-bold tw-text-sky-600">{{ proj.get_status_display }}</span>
                    </div>
                    <div class="tw-w-full tw-bg-slate-100 tw-rounded-full tw-h-2">
                        <div class="tw-bg-sky-500 tw-h-2 tw-rounded-full" style="width: {{ proj.progress }}%"></div>
                    </div>
                    <p class="tw-text-xs tw-text-right tw-text-slate-500 tw-mt-2">{{ proj.progress }}% Complete</p>
                </div>
                {% endfor %}
                {% else %}
                <div
                    class="tw-text-center tw-py-12 tw-bg-white tw-rounded-xl tw-border tw-border-dashed tw-border-slate-300">
                    <p class="tw-text-slate-500">No active projects.</p>
                </div>
                {% endif %}
            </div>

        </div>
    </div>
</section>
{% endblock %}