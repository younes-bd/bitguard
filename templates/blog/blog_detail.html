{% extends "blog/base_blog.html" %}

{% block blog_title %}{{ post.title }}{% endblock %}
{% block blog_subtitle %}{{ post.meta_description|default:"" }}{% endblock %}

{% block blog_content %}

<article
    class="tw-bg-slate-800/50 tw-backdrop-blur-sm tw-border tw-border-slate-700/50 tw-rounded-2xl tw-overflow-hidden tw-animate-fade-in-up">

    <!-- Featured Image -->
    {% if post.featured_image %}
    <div class="tw-relative tw-w-full tw-aspect-video tw-overflow-hidden">
        <img src="{{ post.featured_image.url }}" alt="{{ post.title }}" class="tw-w-full tw-h-full tw-object-cover">
    </div>
    {% endif %}

    <div class="tw-p-8 tw-lg:tw-p-12">
        <!-- Metadata -->
        <div class="tw-flex tw-flex-wrap tw-items-center tw-gap-4 tw-text-sm tw-text-slate-400 tw-mb-8">
            <span class="tw-flex tw-items-center tw-gap-2">
                <i class="far fa-calendar"></i> {{ post.publish_date|date:"F d, Y" }}
            </span>
            <span class="tw-flex tw-items-center tw-gap-2">
                <i class="far fa-user"></i> {{ post.author.username }}
            </span>
            {% if post.category %}
            <a href="{% url 'blog:category_post' post.category.slug %}"
                class="tw-flex tw-items-center tw-gap-2 tw-text-cyan-400 hover:tw-text-cyan-300">
                <i class="fas fa-folder-open"></i> {{ post.category.name }}
            </a>
            {% endif %}
        </div>

        <!-- Content -->
        <div class="tw-prose tw-prose-invert tw-prose-cyan tw-max-w-none">
            {{ post.content|safe }}
        </div>

        <!-- Tags -->
        {% if post.tags.all %}
        <div class="tw-mt-12 tw-pt-8 tw-border-t tw-border-slate-700">
            <h4 class="tw-text-sm tw-font-bold tw-text-slate-400 tw-uppercase tw-tracking-wider tw-mb-4">Tags</h4>
            <div class="tw-flex tw-flex-wrap tw-gap-2">
                {% for tag in post.tags.all %}
                <a href="{% url 'blog:tag_post' tag.slug %}"
                    class="tw-px-3 tw-py-1 tw-bg-slate-700 tw-text-slate-300 tw-rounded-full tw-text-sm hover:tw-bg-cyan-500/20 hover:tw-text-cyan-400 tw-transition-colors">
                    #{{ tag.name }}
                </a>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Share -->
        <div class="tw-mt-8 tw-flex tw-items-center tw-gap-4">
            <span class="tw-text-slate-400 tw-font-semibold">Share:</span>
            <a href="https://twitter.com/intent/tweet?text={{ post.title }}&url={{ request.build_absolute_uri }}"
                target="_blank"
                class="tw-w-10 tw-h-10 tw-flex tw-items-center tw-justify-center tw-rounded-full tw-bg-slate-700 tw-text-white hover:tw-bg-[#1DA1F2] tw-transition-colors">
                <i class="fab fa-twitter"></i>
            </a>
            <a href="https://www.linkedin.com/shareArticle?mini=true&url={{ request.build_absolute_uri }}&title={{ post.title }}"
                target="_blank"
                class="tw-w-10 tw-h-10 tw-flex tw-items-center tw-justify-center tw-rounded-full tw-bg-slate-700 tw-text-white hover:tw-bg-[#0077b5] tw-transition-colors">
                <i class="fab fa-linkedin-in"></i>
            </a>
        </div>
    </div>
</article>

<!-- Comments Section -->
<div class="tw-mt-12">
    <h3 class="tw-text-2xl tw-font-bold tw-mb-8">Comments ({{ post.comments.count }})</h3>

    <!-- Comment Form -->
    {% if user.is_authenticated %}
    <div class="tw-bg-slate-800/30 tw-rounded-xl tw-p-6 tw-mb-8 tw-border tw-border-slate-700/50">
        <h4 class="tw-text-lg tw-font-semibold tw-mb-4">Leave a comment</h4>
        <form method="post">
            {% csrf_token %}
            <div class="tw-mb-4">
                {{ comment_form.content }}
            </div>
            <button type="submit"
                class="tw-px-6 tw-py-2 tw-bg-cyan-600 tw-text-white tw-rounded-lg hover:tw-bg-cyan-500 tw-transition-colors tw-font-semibold">
                Post Comment
            </button>
        </form>
    </div>
    {% else %}
    <div class="tw-bg-slate-800/30 tw-rounded-xl tw-p-6 tw-mb-8 tw-border tw-border-slate-700/50 tw-text-center">
        <p class="tw-text-slate-400">Please <a href="{% url 'login' %}?next={{ request.path }}"
                class="tw-text-cyan-400 hover:tw-underline">log in</a> to leave a comment.</p>
    </div>
    {% endif %}

    <!-- Comment List -->
    <div class="tw-space-y-6">
        {% for comment in post.comments.all %}
        {% if comment.is_active %}
        <div class="tw-flex tw-gap-4">
            <div class="tw-flex-shrink-0">
                <div
                    class="tw-w-10 tw-h-10 tw-rounded-full tw-bg-slate-700 tw-flex tw-items-center tw-justify-center tw-text-slate-300">
                    <i class="fas fa-user"></i>
                </div>
            </div>
            <div class="tw-flex-grow">
                <div class="tw-bg-slate-800/30 tw-rounded-xl tw-p-4 tw-border tw-border-slate-700/50">
                    <div class="tw-flex tw-items-center tw-justify-between tw-mb-2">
                        <span class="tw-font-semibold tw-text-white">{{ comment.author.username }}</span>
                        <span class="tw-text-xs tw-text-slate-500">{{ comment.created_at|timesince }} ago</span>
                    </div>
                    <p class="tw-text-slate-300 tw-text-sm">{{ comment.content }}</p>
                </div>
            </div>
        </div>
        {% endif %}
        {% empty %}
        <p class="tw-text-slate-500 text-center">No comments yet. Be the first to share your thoughts!</p>
        {% endfor %}
    </div>
</div>

{% endblock %}
